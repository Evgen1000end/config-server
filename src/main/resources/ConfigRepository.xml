<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ru.demkin.esb.configserver.repository.ConfigRepositoty">

  <insert id="saveConfig">
    INSERT INTO postgres.public.configs (value, is_admin, uri, label, username)
    values (#{value}, #{isAdmin}, #{description.uri}, #{description.label}, #{username})

  </insert>

  <update id="updateConfig">
    UPDATE
      postgres.public.configs
    SET value    = #{value},
        is_admin = #{isAdmin},
        uri      = #{uri},
        label    = #{description.label}
    WHERE ((is_admin = #{isAdmin} and username is null) or username = #{username})
      AND uri = #{uri}
  </update>

  <!--  Методы поиска-->
  <select id="findConfigs" resultType="ru.demkin.esb.configserver.model.ConfigDescriptionDto">
    SELECT *
    FROM postgres.public.configs
    WHERE (is_admin = #{isAdmin} and username is null)
       or username = #{username};
  </select>

  <select id="findConfigsByUrl" resultType="ru.demkin.esb.configserver.model.ConfigDescriptionDto">
    SELECT *
    FROM postgres.public.configs
    WHERE ((is_admin = #{isAdmin} and username is null) or username = #{username})
      AND uri = #{uri};
  </select>

  <delete id="deleteConfig">
    DELETE
    FROM postgres.public.configs
    WHERE ((is_admin = #{isAdmin} and username is null) or username = #{username})
      AND uri = #{uri};
  </delete>

</mapper>
